# Лабораторная работа 2

**Название:** "Разработка драйверов блочных устройств"

**Цель работы:**  получить знания и навыки разработки драйверов блочных устройств для операционной системы Linux. 

## Описание функциональности драйвера

Драйвер создаёт блочкое устройство /dev/sblkdeN (N - присвоенный системой номер), которое содержит 3 первичных раздела с размерами 10Мбайт, 25Мбайт и  15Мбайт.

## Инструкция по сборке

Открыть терминал в данной директории и выполнить команду make

Модуль ядра будет скомпилирован в файл lab2.ko

## Инструкция пользователя

Чтобы добавить модуль, нужно выполнить команду insmod lab2.ko

Для удаления модуля - rmmod lab2

Добавить или удалить модуль можно только от имени root

К виртуальному блочному устройству и его разделам применимы все операции, применимые к другим блочным устройствам.

Всё, что происходит с блочным устройством, сохраняется только в оперативной памяти. При выгрузке модуля виртуальное устройство будет возвращено в исходное состояние с потерей всех данных.

## Примеры использования

mkfs.vfat /dev/sblkdev0p1 - форматирует раздел на устройстве в файловую систему FAT

mount /dev/sblkdev0p1 /cdrom - монтирует раздел в указанную точку

## Тестирование скорости

Тестирование проводилось командой dd с файлом объёмом 10 Мбайт

Копирование с физического устройства на виртуальное:

1+0 records in

1+0 records out

10485760 bytes (10 MB, 10 MiB) copied, 0,0271871 s, 386 MB/s


Копирование между разделами виртуального устройства:

1+0 records in

1+0 records out

10485760 bytes (10 MB, 10 MiB) copied, 0,00913006 s, 1,1 GB/s


При копировании между разделмаи виртуального устройства скорость выше, так как оба раздела находятся в оперативной памяти, и копирование выполняется со скоростью оперативной памяти. При копировании с реального жётского диска он становится узким местом.
